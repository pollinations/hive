<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM SVG Art Evolution</title>
    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent: #4f9eff;
            --border: #404040;
            --input-bg: #333333;
        }
        
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg-primary);
            line-height: 1.5;
            color: var(--text-primary);
        }
        
        h1, h2 {
            color: var(--text-primary);
            margin-bottom: 1em;
        }
        
        .container {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
        }
        
        select, textarea {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-primary);
            font-family: inherit;
        }
        
        select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .svg-container {
            display: block;
            width: 720px;
            height: 600px;
            overflow: auto;
            background: var(--bg-primary);
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
        }
        
        button {
            padding: 8px 16px;
            background: var(--accent);
            color: var(--text-primary);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background: #3d8be6;
        }
        
        button:disabled {
            background: var(--border);
            cursor: not-allowed;
        }
        
        #history {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        label {
            display: block;
            margin: 8px 0;
            color: var(--text-secondary);
        }
        
        #speed-slider {
            -webkit-appearance: none;
            background: var(--border);
            height: 2px;
            direction: rtl;
        }
        
        #speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        #speed-slider::-webkit-slider-thumb:hover {
            background: #3d8be6;
        }

        #speed-slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: none;
            transition: background-color 0.2s;
        }
        
        #speed-slider::-moz-range-thumb:hover {
            background: #3d8be6;
        }

        #speed-slider::-moz-range-progress {
            background-color: transparent;
        }
        
        input[type="number"] {
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 4px 8px;
        }
        
        input[type="range"] {
            accent-color: var(--accent);
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }
    </style>
</head>
<body>
    <h1>LLM SVG Art Evolution</h1>
    
    <div class="container">
        <label for="preset-select">Select Preset:</label>
        <select id="preset-select">
            <option value="solarpunk">Solarpunk Utopia</option>
            <option value="isometric">Isometric Cityscape</option>
            <option value="cellular">Cellular Patterns</option>
            <option value="bauhaus">Bauhaus Dreams</option>
            <option value="quantum">Quantum Realms</option>
            <option value="biomorphic">Biomorphic Systems</option>
            <option value="cosmology">Cosmic Architecture</option>
            <option value="neural">Neural Gardens</option>
            <option value="meditation">Inner Landscapes</option>
            <option value="emergence">Emergent Behaviors</option>
        </select>
        
        <label for="base-prompt">Animation Prompt:</label>
        <textarea id="base-prompt" rows="4"></textarea>
        
        <label for="model-select">Model:</label>
        <select id="model-select"></select>

        <div style="display: flex; align-items: center; gap: 20px; margin: 10px 0;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <label for="temperature">Temperature:</label>
                <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.8">
                <span id="temperature-value">0.8</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <label for="seed">Seed:</label>
                <input type="number" id="seed" value="-1">
            </div>
        </div>

        <div id="preview-window" class="svg-container"></div>
        
        <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
            <label for="speed-slider">Speed:</label>
            <input type="range" id="speed-slider" min="100" max="2000" value="700" step="100" style="direction: rtl;">
        </div>
        
        <div>
            <button id="startBtn">Start Evolution</button>
            <button id="stopBtn" disabled>Stop Evolution</button>
        </div>
    </div>

    <div class="container">
        <h2>History</h2>
        <div id="history"></div>
    </div>

    <script>
        const elements = {
            presetSelect: document.getElementById('preset-select'),
            basePrompt: document.getElementById('base-prompt'),
            modelSelect: document.getElementById('model-select'),
            temperature: document.getElementById('temperature'),
            temperatureValue: document.getElementById('temperature-value'),
            seed: document.getElementById('seed'),
            preview: document.getElementById('preview-window'),
            speedSlider: document.getElementById('speed-slider'),
            start: document.getElementById('startBtn'),
            stop: document.getElementById('stopBtn'),
            history: document.getElementById('history')
        };

        // Presets for SVG generation
        const presets = {
            solarpunk: {
                prompt: "Create an evolving solarpunk cityscape where nature and technology harmoniously intertwine. Use flowing organic curves for plant life mixed with clean geometric shapes for sustainable architecture. Include animated elements like swaying trees, floating gardens, and shimmering solar panels. Use vibrant greens and warm sunlit colors.",
                temperature: 0.9
            },
            isometric: {
                prompt: "Generate an isometric architectural composition inspired by M.C. Escher and impossible geometry. Create intricate 3D structures with precise angles, interconnected pathways, and recursive patterns. Use animated perspective shifts and transformations. Employ a sophisticated color palette with subtle gradients.",
                temperature: 0.8
            },
            cellular: {
                prompt: "Visualize a cellular automaton system inspired by Conway's Game of Life but with artistic flair. Create evolving patterns of geometric cells that pulse, grow, and transform. Use animated transitions between states. Incorporate mathematical beauty with organic unpredictability.",
                temperature: 0.85
            },
            bauhaus: {
                prompt: "Design an animated Bauhaus-inspired composition that celebrates geometric abstraction and modernist principles. Use primary colors, bold shapes, and clean lines in dynamic arrangements. Include subtle rotations and translations that reflect industrial rhythm and mechanical precision.",
                temperature: 0.7
            },
            quantum: {
                prompt: "Visualize quantum phenomena through abstract art - wave-particle duality, superposition, and entanglement. Create animated probability clouds, interference patterns, and quantum tunneling effects. Use ethereal colors and translucent layers to suggest the mysterious nature of quantum reality.",
                temperature: 0.95
            },
            biomorphic: {
                prompt: "Create a living system of biomorphic forms inspired by Ernst Haeckel's scientific illustrations. Design intricate organic shapes that grow, divide, and evolve. Use animated transformations to suggest cellular processes and biological rhythms. Include delicate details and symmetrical patterns.",
                temperature: 0.9
            },
            cosmology: {
                prompt: "Design an abstract representation of cosmic architecture - galaxy formations, gravitational lensing, and spacetime fabric. Create animated elements suggesting orbital motion and celestial mechanics. Use deep space colors and geometric patterns inspired by astronomical phenomena.",
                temperature: 0.85
            },
            neural: {
                prompt: "Visualize a garden of artificial neural networks as living, breathing entities. Create organic-mechanical hybrid forms with animated synaptic connections and information flows. Show learning and adaptation through evolving patterns and emergent behaviors.",
                temperature: 0.9
            },
            meditation: {
                prompt: "Generate abstract visualizations of inner mental states and consciousness. Create flowing mandalas and organic patterns that pulse with meditative rhythms. Use subtle animations and transitions to induce contemplative states. Incorporate sacred geometry and archetypal forms.",
                temperature: 0.8
            },
            emergence: {
                prompt: "Design a complex system showing emergent behavior from simple rules. Create animated patterns that suggest flocking birds, forming crystals, or growing cities. Use mathematical principles to generate organic complexity. Show how individual elements combine to create larger organized structures.",
                temperature: 0.85
            }
        };

        // Fetch available models
        fetch('https://text.pollinations.ai/models')
            .then(r => r.json())
            .then(models => {
                elements.modelSelect.innerHTML = models
                    .map(m => `<option value="${m.name}" ${m.name === 'openai-large' ? 'selected' : ''}>${m.name} - ${m.description}</option>`)
                    .join('');
            });

        function getSelectedModel() {
            return elements.modelSelect.value;
        }

        // State
        let isRunning = false;
        let frames = [];
        let frameIndex = 0;
        let animationTimer = null;

        function createEmptyCanvas() {
            elements.preview.innerHTML = `
                <svg width="100%" height="100%" viewBox="0 0 800 600">
                    <rect width="100%" height="100%" fill="var(--bg-primary)"/>
                    <text x="50%" y="50%" text-anchor="middle" fill="var(--text-secondary)" font-family="system-ui, sans-serif">
                        Start evolution to generate SVG art
                    </text>
                </svg>
            `;
        }

        function extractSvgContent(text) {
            const svgMatch = text.match(/```(?:svg|xml)\n([\s\S]*?)\n```/);
            return svgMatch ? svgMatch[1].trim() : null;
        }

        function startPreviewAnimation() {
            if (animationTimer) clearInterval(animationTimer);
            
            animationTimer = setInterval(() => {
                if (frames.length > 0) {
                    elements.preview.innerHTML = frames[frameIndex];
                    frameIndex = (frameIndex + 1) % frames.length;
                }
            }, parseInt(elements.speedSlider.value));
        }

        async function generateText(prompt, currentState, retryCount = 0) {
            const maxRetries = 3;
            const model = getSelectedModel();
            const temperature = parseFloat(elements.temperature.value);
            const seed = parseInt(elements.seed.value) >= 0 ? 
                parseInt(elements.seed.value) : 
                Math.floor(Math.random() * 1000000) + retryCount; // Add retryCount to ensure different seeds

            const systemPrompt = `You are an animated SVG art generator. Create SVG code that fits within a 800x600 viewBox.
            Follow these rules:
            1. Always start with <?xml version="1.0" encoding="UTF-8"?> and proper SVG tags
            2. Use simple shapes, paths, and basic SVG elements
            3. Include style definitions in a <defs> section
            4. Always ensure the SVG is complete and properly closed
            5. If evolving from a previous state, introduce only gradual changes!
            6. Return ONLY the SVG code wrapped in \`\`\`svg code blocks
            7. use animations abundantly
            

            Current state: ${currentState ? 'Building upon previous SVG. Change gradually.' : 'Creating initial SVG'}`;

            try {
                const response = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model,
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: prompt }
                        ],
                        temperature,
                        seed
                    })
                });

                if (!response.ok) throw new Error('API request failed');
                
                const text = await response.text();
                const svgContent = extractSvgContent(text);
                
                // Validate SVG completeness
                if (!svgContent) {
                    throw new Error('No valid SVG content found in response');
                }
                
                if (!svgContent.includes('</svg>')) {
                    throw new Error('Incomplete SVG content');
                }
                
                return svgContent;
            } catch (error) {
                console.error(`Generation error (attempt ${retryCount + 1}/${maxRetries + 1}):`, error);
                
                if (retryCount < maxRetries) {
                    console.log('Retrying with a different seed...');
                    return generateText(prompt, currentState, retryCount + 1);
                }
                
                return null;
            }
        }

        async function evolve() {
            if (!isRunning) return;

            const preset = presets[elements.presetSelect.value];
            const basePrompt = elements.basePrompt.value || preset.prompt;
            
            try {
                const currentState = frames.length > 0 ? frames[frames.length - 1] : null;
                const evolutionPrompt = currentState 
                    ? `Evolve this SVG art while maintaining some consistency with the previous state. ${basePrompt}`
                    : basePrompt;

                const svgContent = await generateText(evolutionPrompt, currentState);
                
                if (svgContent) {
                    frames.push(svgContent);
                    
                    // Add to history
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div style="width: 200px; height: 150px;">
                            ${svgContent}
                        </div>
                    `;
                    elements.history.insertBefore(historyItem, elements.history.firstChild);
                    
                    // Keep evolving
                    if (isRunning) {
                        setTimeout(evolve, 100);
                    }
                } else {
                    console.error('Failed to generate SVG content');
                    stopEvolution();
                }
            } catch (error) {
                console.error('Evolution error:', error);
                stopEvolution();
            }
        }

        function startEvolution() {
            isRunning = true;
            elements.start.disabled = true;
            elements.stop.disabled = false;
            frames = [];
            frameIndex = 0;
            evolve();
            startPreviewAnimation();
        }

        function stopEvolution() {
            isRunning = false;
            elements.start.disabled = false;
            elements.stop.disabled = true;
            if (animationTimer) {
                clearInterval(animationTimer);
                animationTimer = null;
            }
        }

        // Event Listeners
        elements.start.addEventListener('click', startEvolution);
        elements.stop.addEventListener('click', stopEvolution);
        elements.temperature.addEventListener('input', (e) => {
            elements.temperatureValue.textContent = e.target.value;
        });
        elements.presetSelect.addEventListener('change', (e) => {
            const preset = presets[e.target.value];
            elements.basePrompt.value = preset.prompt;
            elements.temperature.value = preset.temperature;
            elements.temperatureValue.textContent = preset.temperature;
        });

        // Initialize
        createEmptyCanvas();
        elements.basePrompt.value = presets[elements.presetSelect.value].prompt;
    </script>
</body>
</html>
