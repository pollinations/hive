<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM SVG Art Evolution</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .svg-container {
            display: block;
            width: 720px;
            height: 600px;
            overflow: auto;
            background: #f8f8f8;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        textarea, select {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
        }
        button {
            padding: 8px 16px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
        }
        button:disabled {
            background: #ccc;
        }
        #history {
            max-height: 400px;
            overflow-y: auto;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        label {
            display: block;
            margin: 8px 0;
        }
        #speed-slider {
            -webkit-appearance: none;
            background: #ddd;
            height: 2px;
            direction: rtl;
        }
        
        #speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #666;
            cursor: pointer;
        }

        #speed-slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #666;
            cursor: pointer;
            border: none;
        }

        #speed-slider::-moz-range-progress {
            background-color: transparent;
        }
    </style>
</head>
<body>
    <h1>LLM SVG Art Evolution</h1>
    
    <div class="container">
        <label for="preset-select">Select Preset:</label>
        <select id="preset-select">
            <option value="geometric">Geometric Patterns</option>
            <option value="organic">Organic Shapes</option>
            <option value="abstract">Abstract Art</option>
            <option value="landscape">Digital Landscape</option>
            <option value="portrait">Portrait Elements</option>
            <option value="circuit">Circuit Board Design</option>
            <option value="mandala">Mandala Patterns</option>
            <option value="waves">Wave Interference</option>
            <option value="grid">Grid Compositions</option>
            <option value="flow">Flow Fields</option>
        </select>
        
        <label for="base-prompt">Animation Prompt:</label>
        <textarea id="base-prompt" rows="4"></textarea>
        
        <label for="model-select">Model:</label>
        <select id="model-select"></select>

        <div style="display: flex; align-items: center; gap: 20px; margin: 10px 0;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <label for="temperature">Temperature:</label>
                <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.8">
                <span id="temperature-value">0.8</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <label for="seed">Seed:</label>
                <input type="number" id="seed" value="-1">
            </div>
        </div>

        <div id="preview-window" class="svg-container"></div>
        
        <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
            <label for="speed-slider">Speed:</label>
            <input type="range" id="speed-slider" min="100" max="2000" value="700" step="100" style="direction: rtl;">
        </div>
        
        <div>
            <button id="startBtn">Start Evolution</button>
            <button id="stopBtn" disabled>Stop Evolution</button>
        </div>
    </div>

    <div class="container">
        <h2>History</h2>
        <div id="history"></div>
    </div>

    <script>
        const elements = {
            presetSelect: document.getElementById('preset-select'),
            basePrompt: document.getElementById('base-prompt'),
            modelSelect: document.getElementById('model-select'),
            temperature: document.getElementById('temperature'),
            temperatureValue: document.getElementById('temperature-value'),
            seed: document.getElementById('seed'),
            preview: document.getElementById('preview-window'),
            speedSlider: document.getElementById('speed-slider'),
            start: document.getElementById('startBtn'),
            stop: document.getElementById('stopBtn'),
            history: document.getElementById('history')
        };

        // Presets for SVG generation
        const presets = {
            geometric: {
                prompt: "Create an SVG with basic geometric shapes (circles, rectangles, polygons) arranged in a balanced composition. Use clean lines and primary colors. The shapes should form an abstract pattern that suggests movement and harmony.",
                temperature: 0.8
            },
            organic: {
                prompt: "Generate an SVG with flowing, organic curves using path elements. Create natural, biomorphic shapes that suggest growth and movement. Include gentle gradients and earth tones.",
                temperature: 0.9
            },
            abstract: {
                prompt: "Design an abstract SVG composition using a mix of geometric and organic shapes. Layer transparent elements, use bold colors, and create dynamic intersections between shapes. Think Kandinsky-style modernist artwork.",
                temperature: 0.9
            },
            landscape: {
                prompt: "Create a minimalist landscape SVG using simple shapes and lines. Represent hills, trees, or buildings using geometric abstractions. Use a limited color palette with subtle gradients for depth.",
                temperature: 0.7
            },
            portrait: {
                prompt: "Generate an abstract face or portrait using SVG shapes. Use simple geometric forms to suggest facial features. Create an expressive composition that balances representation and abstraction.",
                temperature: 0.8
            },
            circuit: {
                prompt: "Design an SVG that resembles a circuit board pattern. Use straight lines, right angles, and circular connection points. Create a complex network of paths that suggests technological connectivity.",
                temperature: 0.7
            },
            mandala: {
                prompt: "Generate a symmetrical mandala pattern using SVG. Create intricate geometric patterns that radiate from the center. Use repetition and mathematical precision in the arrangement of shapes.",
                temperature: 0.8
            },
            waves: {
                prompt: "Create an SVG pattern of intersecting waves and ripples. Use curved paths and varying stroke widths to suggest interference patterns. Layer semi-transparent shapes to create depth and complexity.",
                temperature: 0.85
            },
            grid: {
                prompt: "Generate a grid-based SVG composition. Create variations in the grid using different sizes and colors of shapes. Include occasional disruptions to the pattern for visual interest.",
                temperature: 0.7
            },
            flow: {
                prompt: "Design an SVG flow field visualization. Create patterns of curved lines that suggest fluid dynamics or magnetic fields. Use varying line weights and colors to indicate field strength.",
                temperature: 0.9
            }
        };

        // Fetch available models
        fetch('https://text.pollinations.ai/models')
            .then(r => r.json())
            .then(models => {
                elements.modelSelect.innerHTML = models
                    .map(m => `<option value="${m.name}" ${m.name === 'openai-large' ? 'selected' : ''}>${m.name} - ${m.description}</option>`)
                    .join('');
            });

        function getSelectedModel() {
            return elements.modelSelect.value;
        }

        // State
        let isRunning = false;
        let frames = [];
        let frameIndex = 0;
        let animationTimer = null;

        function createEmptyCanvas() {
            elements.preview.innerHTML = `
                <svg width="100%" height="100%" viewBox="0 0 800 600">
                    <rect width="100%" height="100%" fill="#f8f8f8"/>
                    <text x="50%" y="50%" text-anchor="middle" fill="#666">
                        Start evolution to generate SVG art
                    </text>
                </svg>
            `;
        }

        function extractSvgContent(text) {
            const svgMatch = text.match(/```(?:svg|xml)\n([\s\S]*?)\n```/);
            return svgMatch ? svgMatch[1].trim() : null;
        }

        function startPreviewAnimation() {
            if (animationTimer) clearInterval(animationTimer);
            
            animationTimer = setInterval(() => {
                if (frames.length > 0) {
                    elements.preview.innerHTML = frames[frameIndex];
                    frameIndex = (frameIndex + 1) % frames.length;
                }
            }, parseInt(elements.speedSlider.value));
        }

        async function generateText(prompt, currentState, retryCount = 0) {
            const maxRetries = 3;
            const model = getSelectedModel();
            const temperature = parseFloat(elements.temperature.value);
            const seed = parseInt(elements.seed.value) >= 0 ? 
                parseInt(elements.seed.value) : 
                Math.floor(Math.random() * 1000000) + retryCount; // Add retryCount to ensure different seeds

            const systemPrompt = `You are an animated SVG art generator. Create SVG code that fits within a 800x600 viewBox.
            Follow these rules:
            1. Always start with <?xml version="1.0" encoding="UTF-8"?> and proper SVG tags
            2. Use simple shapes, paths, and basic SVG elements
            3. Include style definitions in a <defs> section
            4. Always ensure the SVG is complete and properly closed
            5. If evolving from a previous state, introduce only gradual changes!
            6. Return ONLY the SVG code wrapped in \`\`\`svg code blocks
            7. use animations abundantly
            

            Current state: ${currentState ? 'Building upon previous SVG. Change gradually.' : 'Creating initial SVG'}`;

            try {
                const response = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model,
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: prompt }
                        ],
                        temperature,
                        seed
                    })
                });

                if (!response.ok) throw new Error('API request failed');
                
                const text = await response.text();
                const svgContent = extractSvgContent(text);
                
                // Validate SVG completeness
                if (!svgContent) {
                    throw new Error('No valid SVG content found in response');
                }
                
                if (!svgContent.includes('</svg>')) {
                    throw new Error('Incomplete SVG content');
                }
                
                return svgContent;
            } catch (error) {
                console.error(`Generation error (attempt ${retryCount + 1}/${maxRetries + 1}):`, error);
                
                if (retryCount < maxRetries) {
                    console.log('Retrying with a different seed...');
                    return generateText(prompt, currentState, retryCount + 1);
                }
                
                return null;
            }
        }

        async function evolve() {
            if (!isRunning) return;

            const preset = presets[elements.presetSelect.value];
            const basePrompt = elements.basePrompt.value || preset.prompt;
            
            try {
                const currentState = frames.length > 0 ? frames[frames.length - 1] : null;
                const evolutionPrompt = currentState 
                    ? `Evolve this SVG art while maintaining some consistency with the previous state. ${basePrompt}`
                    : basePrompt;

                const svgContent = await generateText(evolutionPrompt, currentState);
                
                if (svgContent) {
                    frames.push(svgContent);
                    
                    // Add to history
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div style="width: 200px; height: 150px;">
                            ${svgContent}
                        </div>
                    `;
                    elements.history.insertBefore(historyItem, elements.history.firstChild);
                    
                    // Keep evolving
                    if (isRunning) {
                        setTimeout(evolve, 100);
                    }
                } else {
                    console.error('Failed to generate SVG content');
                    stopEvolution();
                }
            } catch (error) {
                console.error('Evolution error:', error);
                stopEvolution();
            }
        }

        function startEvolution() {
            isRunning = true;
            elements.start.disabled = true;
            elements.stop.disabled = false;
            frames = [];
            frameIndex = 0;
            evolve();
            startPreviewAnimation();
        }

        function stopEvolution() {
            isRunning = false;
            elements.start.disabled = false;
            elements.stop.disabled = true;
            if (animationTimer) {
                clearInterval(animationTimer);
                animationTimer = null;
            }
        }

        // Event Listeners
        elements.start.addEventListener('click', startEvolution);
        elements.stop.addEventListener('click', stopEvolution);
        elements.temperature.addEventListener('input', (e) => {
            elements.temperatureValue.textContent = e.target.value;
        });
        elements.presetSelect.addEventListener('change', (e) => {
            const preset = presets[e.target.value];
            elements.basePrompt.value = preset.prompt;
            elements.temperature.value = preset.temperature;
            elements.temperatureValue.textContent = preset.temperature;
        });

        // Initialize
        createEmptyCanvas();
        elements.basePrompt.value = presets[elements.presetSelect.value].prompt;
    </script>
</body>
</html>
