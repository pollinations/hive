var n;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.FFPROBE="FFPROBE",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(n||(n={}));const D=(()=>{let r=0;return()=>r++})(),O=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),L=new Error("called FFmpeg.terminate()");class A{#e=null;#s={};#r={};#n=[];#E=[];loaded=!1;#i=()=>{this.#e&&(this.#e.onmessage=({data:{id:t,type:e,data:s}})=>{switch(e){case n.LOAD:this.loaded=!0,this.#s[t](s);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.FFPROBE:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:this.#s[t](s);break;case n.LOG:this.#n.forEach(E=>E(s));break;case n.PROGRESS:this.#E.forEach(E=>E(s));break;case n.ERROR:this.#r[t](s);break}delete this.#s[t],delete this.#r[t]})};#t=({type:t,data:e},s=[],E)=>this.#e?new Promise((a,R)=>{const i=D();this.#e&&this.#e.postMessage({id:i,type:t,data:e},s),this.#s[i]=a,this.#r[i]=R,E?.addEventListener("abort",()=>{R(new DOMException(`Message # ${i} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(O);on(t,e){t==="log"?this.#n.push(e):t==="progress"&&this.#E.push(e)}off(t,e){t==="log"?this.#n=this.#n.filter(s=>s!==e):t==="progress"&&(this.#E=this.#E.filter(s=>s!==e))}load=({classWorkerURL:t,...e}={},{signal:s}={})=>(this.#e||(this.#e=t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/hive/pr-161/live-wallpaper-creator/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"}),this.#i()),this.#t({type:n.LOAD,data:e},void 0,s));exec=(t,e=-1,{signal:s}={})=>this.#t({type:n.EXEC,data:{args:t,timeout:e}},void 0,s);ffprobe=(t,e=-1,{signal:s}={})=>this.#t({type:n.FFPROBE,data:{args:t,timeout:e}},void 0,s);terminate=()=>{const t=Object.keys(this.#r);for(const e of t)this.#r[e](L),delete this.#r[e],delete this.#s[e];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(t,e,{signal:s}={})=>{const E=[];return e instanceof Uint8Array&&E.push(e.buffer),this.#t({type:n.WRITE_FILE,data:{path:t,data:e}},E,s)};mount=(t,e,s)=>{const E=[];return this.#t({type:n.MOUNT,data:{fsType:t,options:e,mountPoint:s}},E)};unmount=t=>{const e=[];return this.#t({type:n.UNMOUNT,data:{mountPoint:t}},e)};readFile=(t,e="binary",{signal:s}={})=>this.#t({type:n.READ_FILE,data:{path:t,encoding:e}},void 0,s);deleteFile=(t,{signal:e}={})=>this.#t({type:n.DELETE_FILE,data:{path:t}},void 0,e);rename=(t,e,{signal:s}={})=>this.#t({type:n.RENAME,data:{oldPath:t,newPath:e}},void 0,s);createDir=(t,{signal:e}={})=>this.#t({type:n.CREATE_DIR,data:{path:t}},void 0,e);listDir=(t,{signal:e}={})=>this.#t({type:n.LIST_DIR,data:{path:t}},void 0,e);deleteDir=(t,{signal:e}={})=>this.#t({type:n.DELETE_DIR,data:{path:t}},void 0,e)}var f;(function(r){r.MEMFS="MEMFS",r.NODEFS="NODEFS",r.NODERAWFS="NODERAWFS",r.IDBFS="IDBFS",r.WORKERFS="WORKERFS",r.PROXYFS="PROXYFS"})(f||(f={}));const u=new Error("failed to get response body reader"),I=new Error("failed to complete download"),_="Content-Length",w=async(r,t)=>{const e=await fetch(r);let s;try{const E=parseInt(e.headers.get(_)||"-1"),a=e.body?.getReader();if(!a)throw u;const R=[];let i=0;for(;;){const{done:o,value:d}=await a.read(),h=d?d.length:0;if(o){if(E!=-1&&E!==i)throw I;t&&t({url:r,total:E,received:i,delta:h,done:o});break}R.push(d),i+=h,t&&t({url:r,total:E,received:i,delta:h,done:o})}const c=new Uint8Array(i);let l=0;for(const o of R)c.set(o,l),l+=o.length;s=c.buffer}catch(E){console.log("failed to send download progress event: ",E),s=await e.arrayBuffer()}return s},N=async(r,t,e=!1,s)=>{const E=e?await w(r,s):await(await fetch(r)).arrayBuffer(),a=new Blob([E],{type:t});return URL.createObjectURL(a)};export{A as F,N as t};
